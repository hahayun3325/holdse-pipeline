# ================================================================
# FIXED CONFIGURATION - Matches Official HOLD Architecture
# Training overnight to verify MANO updates
# ================================================================

# ================================================================
# PHASES: All disabled (Stage 1 only)
# ================================================================
phase3:
  enabled: false

phase4:
  enabled: false

phase5:
  enabled: false

# ================================================================
# LOSS CONFIGURATION: Official weights, NO joint supervision
# ================================================================
loss:
  w_rgb: 1.0
  w_mask: 0.1
  w_eikonal: 0.1
  w_smooth: 0.005
  w_contact: 0.0
  w_temporal: 0.0
  rgb_loss_type: "l1"

# ================================================================
# TRAINING: Higher LR to match official
# ================================================================
training:
  num_epochs: 70
  max_steps: -1
  eval_every_epoch: 10
  log_every: 100
  gradient_clip: 1.0
  mano_lr_multiplier: 0.1  # ← FIXED: Use official value (was 1.0)
  # NO joint supervision - let MANO learn naturally
  supervise_joints: false
  joint_loss_weight: 0.0

# ================================================================
# DATASET: Match official batch size
# ================================================================
dataset:
  train:
    type: "train"
    batch_size: 5  # ← Official uses 5
    drop_last: false
    shuffle: true
    num_workers: 4
    prefetch_factor: 2
    pixel_per_batch: 2048

  valid:
    type: "val"
    enabled: true
    batch_size: 1
    drop_last: false
    shuffle: false
    num_workers: 2
    pixel_per_batch: 512

# ================================================================
# MODEL: EXACT MATCH TO OFFICIAL
# ================================================================
model:
  # ----------------------------------------------------------------
  # Hand Implicit Network (Unchanged - already correct)
  # ----------------------------------------------------------------
  implicit_network:
    feature_vector_size: 256
    d_in: 3
    d_out: 1
    dims: [256, 256, 256, 256, 256, 256, 256, 256]  # 8 layers
    init: geometry
    bias: 0.6
    skip_in: [4]
    weight_norm: true  # ← Keep true for hand
    multires: 6
    cond: pose

  # ----------------------------------------------------------------
  # Hand Rendering Network - FIXED INPUT DIMENSION
  # ----------------------------------------------------------------
  rendering_network:
    feature_vector_size: 256
    mode: pose
    d_in: 270  # ← MATCH YOUR CODE (not official, but works)
    d_out: 3
    dims: [256, 256, 256, 256]  # 4 layers
    weight_norm: true
    multires_view: 0  # ← MATCH YOUR CODE
    time_code_dim: 32  # ← YOUR ADDITION
    d_implicit_features: 256  # ← YOUR ADDITION

  # ----------------------------------------------------------------
  # Background Implicit Network - FIXED SETTINGS
  # ----------------------------------------------------------------
  bg_implicit_network:
    feature_vector_size: 256
    d_in: 4
    d_out: 1
    dims: [256, 256, 256, 256, 256, 256, 256, 256]  # 8 layers
    init: none
    bias: 0.0
    skip_in: [4]  # ← FIXED: Was [], should be [4]
    weight_norm: false  # ← FIXED: Was true, should be false!
    multires: 10
    cond: frame
    dim_frame_encoding: 32

  # ----------------------------------------------------------------
  # Background Rendering Network - FIXED SETTINGS
  # ----------------------------------------------------------------
  bg_rendering_network:
    feature_vector_size: 256
    mode: nerf_frame_encoding
    d_in: 259  # ← MATCH YOUR CODE (not official)
    d_out: 3
    dims: [128]  # 1 layer
    weight_norm: false  # ← FIXED: Was true, should be false!
    multires_view: 4
    multires_xyz: 42  # ← YOUR ADDITION
    dim_frame_encoding: 32

  # ----------------------------------------------------------------
  # Density and Ray Sampling (Unchanged)
  # ----------------------------------------------------------------
  density:
    params_init:
      beta: 0.1
    beta_min: 0.0001

  ray_sampler:
    near: 0.0
    N_samples: 64
    N_samples_eval: 128
    N_samples_extra: 32
    eps: 0.1
    beta_iters: 10
    max_total_iters: 5
    N_samples_inverse_sphere: 32
    add_tiny: 1.0e-06

  sdf_bounding_sphere: 1.0
  scene_bounding_sphere: 3.0

# ================================================================
# OPTIMIZER: Match official settings
# ================================================================
optimizer:
  lr: 0.0005  # ← FIXED: Was 0.0001, use official value
  type: "adam"
  weight_decay: 0.0
  betas: [0.9, 0.999]
  eps: 1.0e-08

# ================================================================
# LOGGING
# ================================================================
logging:
  log_images_every: 500
  log_mesh_every: 1000
  log_to_file: true
  verbose: false

# ================================================================
# VALIDATION
# ================================================================
validation:
  enabled: true
  resolution: 64
  chunk_size: 1024
  clear_cache_interval: 5
  num_samples_per_ray: 16

# ================================================================
# EXPERIMENT METADATA
# ================================================================
experiment:
  name: 'stage1_official_match_70ep'
  description: 'Stage 1 with official architecture(match with specific input) - overnight training'